import { CheckBox, GroupBox, VerticalBox, HorizontalBox, SpinBox, TextEdit } from "std-widgets.slint";
import "./assets/fonts/JetBrainsMono-Regular.ttf";
import "./assets/fonts/JetBrainsMono-Bold.ttf";
import "./assets/fonts/JetBrainsMono-LightItalic.ttf";

global Palette {
    out property <brush> rosewater: #f4dbd6;
    out property <brush> flamingo: #f0c6c6;
    out property <brush> pink: #f5bde6;
    out property <brush> mauve: #c6a0f6;
    out property <brush> red: #ed8796;
    out property <brush> maroon: #ee99a0;
    out property <brush> peach: #f5a97f;
    out property <brush> yellow: #eed49f;
    out property <brush> green: #a6da95;
    out property <brush> teal: #8bd5ca;
    out property <brush> sky: #91d7e3;
    out property <brush> sapphire: #7dc4e4;
    out property <brush> blue: #8aadf4;
    out property <brush> lavender: #b7bdf8;
    out property <brush> text: #cad3f5;
    out property <brush> subtext1: #b8c0e0;
    out property <brush> subtext0: #a5adcb;
    out property <brush> overlay2: #939ab7;
    out property <brush> overlay1: #8087a2;
    out property <brush> overlay0: #6e738d;
    out property <brush> surface2: #5b6078;
    out property <brush> surface1: #494d64;
    out property <brush> surface0: #363a4f;
    out property <brush> base: #24273a;
    out property <brush> mantle: #1e2030;
    out property <brush> crust: #181926;
}

component BaseText inherits Text {
    color: Palette.text;
    font-size: 16px;
}

component PropValue {
    in property <string> prop;
    in property <string> value;
    HorizontalLayout {
        alignment: space-between;
        BaseText {
            color: Palette.subtext0;
            text: prop + ":";
        }

        BaseText {
            text: value;
        }
    }
}

component Header inherits Text {
    color: Palette.peach;
    font-size: 20px;
    font-italic: true;
    font-weight: 800;
    font-family: "JetBrains Mono";
}

component BatThreshold {
    callback key-pressed();
    HorizontalLayout {
        alignment: space-between;
        BaseText {
            color: Palette.subtext0;
            text: "Current value:";
            horizontal-stretch: 0;
        }
        text := TextInput {
            width: 32px;
            horizontal-stretch: 1.0;
            font-size: 16px;
            text: "0";
            horizontal-alignment: center;
            input-type: number;
            key-pressed(event) => {
                if event.text.to-float() > 100 {
                    text.text = 100;
                    return EventResult.accept;
                }
                // if event.text.to-float() < 60 {
                //     text.text = 60;
                //     return EventResult.accept;
                // }
                return EventResult.reject;
            }
        }
    }
}

component RadioButton {
    callback clicked;
    in property <bool> checked;
    in property <string> name;
    area := TouchArea {
        mouse-cursor: pointer;
        clicked => {
            root.clicked();
        }
    }

    HorizontalBox {
        padding: 0;
        alignment: start;
        VerticalLayout {
            padding: 0;
            alignment: center;
            outer := Rectangle {
                width: 18px;
                height: 18px;
                border-width: 1px;
                border-radius: 100px;
                border-color: Palette.subtext0;
                states [
                    uncheked-hover when checked: {
                        border-color: Palette.text;
                        out {
                            animate border-color { duration: 100ms; }
                        }
                        in {
                            animate border-color { duration: 100ms; }
                        }
                    }
                ]
                inner := Rectangle {
                    background: Palette.peach;
                    width: 10px;
                    height: 10px;
                    border-radius: 100px;
                    states [
                        uncheked-hover when checked: {
                            opacity: 1.0;
                            out {
                                animate opacity { duration: 100ms; }
                            }
                            in {
                                animate opacity { duration: 100ms; }
                            }
                        }
                        uncheked-hover when area.has-hover: {
                            opacity: 0.5;
                            out {
                                animate opacity { duration: 100ms; }
                            }
                            in {
                                animate opacity { duration: 100ms; }
                            }
                        }
                        unchecked when !root.checked && !area.has-hover: {
                            opacity: 0.0;
                            out {
                                animate opacity { duration: 100ms; }
                            }
                            in {
                                animate opacity { duration: 100ms; }
                            }
                        }
                    ]
                }
            }
        }

        BaseText {
            text: root.name;
            vertical-alignment: center;
            color: Palette.subtext0;
            states [
                checked when checked: {
                    color: Palette.text;
                    out {
                        animate color { duration: 100ms; }
                    }
                    in {
                        animate color { duration: 100ms; }
                    }
                }
            ]
        }
    }
}

struct Monitor {
    fan_mode: int,
    cpu_fan_speed: int,
    gpu_fan_speed: int,
    cpu_temp: int,
    gpu_temp: int,
    bat_threshold: int,
}

export component App inherits Window {
    background: Palette.base;
    padding-top: 0;
    default-font-family: "JetBrains Mono";
    width: 25rem;
    height: 25rem;
    title: "GigaLinux";
    in-out property <int> fan_mode;
    in-out property <Monitor> monitor;
    property <[string]> list-fan-modes: ["Normal", "Eco", "Power", "Turbo"];
    property <[image]> icons: [
        @image-url("./assets/svg/list-ul.svg"),
        @image-url("./assets/svg/fan.svg"),
        @image-url("./assets/svg/battery-full.svg"),
        @image-url("./assets/svg/gear.svg")
    ];
    property <int> tab_state;
    VerticalBox {
        padding-top: 0;
        if tab_state == 0: info := VerticalBox {
            vertical-stretch: 1.0;
            alignment: start;
            Header {
                text: "Machine state";
            }

            PropValue {
                prop: "Fan mode";
                value: monitor.fan-mode;
            }

            PropValue {
                prop: "CPU temp";
                value: monitor.cpu-temp;
            }

            PropValue {
                prop: "GPU temp";
                value: monitor.gpu-temp;
            }

            PropValue {
                prop: "Battery threshold";
                value: monitor.bat-threshold;
            }

            PropValue {
                prop: "CPU fan speed";
                value: monitor.cpu-fan-speed;
            }

            PropValue {
                prop: "GPU fan speed";
                value: monitor.gpu-fan-speed;
            }
        }
        if tab_state == 1: fan_mode := VerticalBox {
            vertical-stretch: 1.0;
            alignment: start;
            Header {
                text: "Fan mode";
            }

            for i in 4: RadioButton {
                checked: root.fan_mode == i ? true : false;
                clicked => {
                    root.fan_mode = i
                }
                name: root.list-fan-modes[i];
            }
        }
        if tab_state == 2: bat_threshold := VerticalBox {
            vertical-stretch: 1.0;
            alignment: start;
            Header {
                text: "Battery threshold";
            }
            BatThreshold {}
        }
        HorizontalBox {
            vertical-stretch: 0.0;
            height: 32px;
            for i in 4: Rectangle {
                area := TouchArea {
                    mouse-cursor: pointer;
                    clicked => {
                        root.tab_state = i;
                    }
                }

                image := Image {
                    width: 20px;
                    height: 20px;
                    source: icons[i];
                    colorize: Palette.surface2;
                    states [
                        active when tab_state == i: {
                            colorize: Palette.peach;
                            opacity: 1;
                            out {
                                animate colorize, opacity { duration: 100ms; }
                            }
                            in {
                                animate colorize, opacity { duration: 100ms; }
                            }
                        }
                        hovered when area.has-hover: {
                            colorize: Palette.peach;
                            opacity: 0.5;
                            out {
                                animate colorize, opacity { duration: 100ms; }
                            }
                            in {
                                animate colorize, opacity { duration: 100ms; }
                            }
                        }
                    ]
                }

                Rectangle {
                    width: parent.width;
                    height: 3px;
                    border-top-left-radius: 4px;
                    border-top-right-radius: 4px;
                    border-bottom-left-radius: 0;
                    border-bottom-right-radius: 0;
                    background: Palette.surface2;
                    y: parent.height + 10px;

                    states [
                        active when tab_state == i: {
                            background: Palette.peach;
                            opacity: 1;
                            out {
                                animate background, opacity { duration: 100ms; }
                            }
                            in {
                                animate background, opacity { duration: 100ms; }
                            }
                        }
                        hovered when area.has-hover: {
                            background: Palette.peach;
                            opacity: 0.5;
                            out {
                                animate background, opacity { duration: 100ms; }
                            }
                            in {
                                animate background, opacity { duration: 100ms; }
                            }
                        }
                    ]
                }

                Rectangle {
                    opacity: 0;
                    width: parent.width;
                    height: 4px;
                    border-top-left-radius: 4px;
                    border-top-right-radius: 4px;
                    border-bottom-left-radius: 0;
                    border-bottom-right-radius: 0;
                    background: Palette.surface2;
                    y: parent.height + 9px;

                    states [
                        active when tab_state == i: {
                            background: Palette.peach;
                            opacity: 1;
                            out {
                                animate background, opacity { duration: 100ms; }
                            }
                            in {
                                animate background, opacity { duration: 100ms; }
                            }
                        }
                    ]
                }
            }
        }
    }
}
